<!DOCTYPE html>
<html><head>
<title>[UOJ91]最大异或和</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="可删除线性基。">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">











<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  






<link rel="stylesheet" href="/scss/journal.min.8e28ea12f6e17fa31de20b68201547b6843cb5deca28115ad2f58c2a899823e3.css" integrity="sha256-jijqEvbhf6Md4gtoIBVHtoQ8td7KKBFa0vWMKomYI&#43;M=" media="screen">



<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>






  <script src="/js/toc.js"></script>















<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script>
  MathJax = {
    tex: {
      inlineMath: [["$", "$"]], [["\\(", "\\)"]],
    },
    displayMath: [
      ["$$", "$$"],
      ["\\[", "\\]"],
    ],
    svg: {
      fontCache: "global",
    },
    options: {
    enableMenu: true,          
    menuOptions: {
      settings: {
        texHints: true,        
        semantics: false,      
        zoom: 'NoZoom',        
        zscale: '200%',        
        renderer: 'CHTML',     
        alt: false,            
        cmd: false,            
        ctrl: false,           
        shift: false,          
        scale: 1,              
        inTabOrder: true,      

        assistiveMml: true,    
        collapsible: false,    
        explorer: false,       
      },
      annotationTypes: {
        TeX: ['TeX', 'LaTeX', 'application/x-tex'],
        StarMath: ['StarMath 5.0'],
        Maple: ['Maple'],
        ContentMathML: ['MathML-Content', 'application/mathml-content+xml'],
        OpenMath: ['OpenMath']
      }
    }
  }
  };
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js">
    MathJax.Hub.Queue(function () {
      
      
      
      var all = MathJax.Hub.getAllJax(), i;
      for (i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>

<style>
  code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
  }
</style>

<link href="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.5.1/styles/atom-one-dark.min.css" rel="stylesheet">
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.initLineNumbersOnLoad();</script>

</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://blog.asukakyle.top">
    
        <div class="nav-title">
            HolyK&#39;s Blog
        </div>
        
        <div class="nav-subtitle">
            明日は明日の風が吹く
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about">
                About
            </a>
            
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/post">
                Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                Categories
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/friend">
                Friends
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS Feed
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	CC BY-NC-SA 4.0
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about">
                    About
                </a>
                
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/post">
                    Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/friend">
                    Friends
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS Feed
                </a>
                
            
            
            <div class="toc">


</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://blog.asukakyle.top">
            HolyK&#39;s Blog
        </a>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://blog.asukakyle.top">
        <div class="single-column-header-title">HolyK&#39;s Blog</div>
        
        <div class="single-column-header-subtitle">明日は明日の風が吹く</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper"
                
                    style="background-image: url('http://www.dmoe.cc/random.php')"
                
            >
                <div class="post-title">
                    [UOJ91]最大异或和
                    
                    <div class="post-subtitle">
                        可删除线性基。
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2021-07-12 08:17
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/%E9%A2%98%E8%A7%A3">题解</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/%E7%BA%BF%E6%80%A7%E5%9F%BA">线性基</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    
> 有一个数列 $a_1,a_2,\dots,a_n$，每个 $a_i$ 都是小于 $2^m$ 的非负整数。
>
> 现在需要实现三种操作，格式说明如下：
>
> - 1 *x* *y* *w*：对于所有 $x≤i≤y$，将 $a_i$ 修改为 $a_i\oplus w$。其中 $w$ 是一个小于 $2^m$ 的非负整数。
> - 2 *x* *y* *w*：对于所有 $x≤i≤y$，将 $a_i$ 修改为 $w$。其中 $w$ 是一个小于 $2^m$ 的非负整数。
> - 3：从 $a_1,a_2,⋯,a_n$ 中选出若干个数，使得选出的数异或和最大。请输出这个最大值。
>
> 这里 $\oplus$ 表示按位异或运算，$x_1,x_2,⋯,x_l$ 的异或和是指 $x_1\oplus x_2\oplus \cdots\oplus x_l$。
> 
> $n,m,q≤2000$。


将原序列差分，线性基不变。

然后每次操作就是单点插入和删除，下面给出两种可删除线性基的写法。

## 离线

记录存活时间，贪心。

```cpp
using BS = std::bitset<2000>;
using PBI = std::pair<BS, int>;
PBI base[2000];
void ins(PBI x) {
  for (int i = 1999; i >= 0; i--) {
    if (!x.first[i]) continue;
    if (x.second > base[i].second) {
      std::swap(x, base[i]);
      if (!x.second) break;
    }
    x.first ^= base[i].first;
  }
}
```

## 在线


$$
PV=B
$$

$$
\det(P)\neq 0,
V = 
\begin{pmatrix}
v_1\\
v_2\\
\vdots\\
v_n
\end{pmatrix},
B=
\begin{pmatrix}
base_1\\
\vdots\\
0\\
\vdots\\
base_m\\
\vdots\\
0\\
\vdots
\end{pmatrix}
$$

记录可逆矩阵 $P$，修改 $v_i$ 时，要将 $P$ 的第 $i$ 列全部变成0。

为了尽量在不影响 $B$ 的情况下消元，首先找 $j$ 满足 $P_{i,j}=1,i\neq j, base_j=0$。

如果找到这样的 $j$ 那么直接消元，$B$ 不会有任何变化。

如果没有找到，那么需要找最小的 $base_k$ 使得 $base_k$ 包含 $v_i$，然后用 $base_k$ 消去其他包含 $v_i$ 的 $base$。


## Code
### 离线
```cpp
// Author:  HolyK
// Created: Mon Jul  5 14:24:21 2021
#include <bits/stdc++.h>
#define dbg(a...) fprintf(stderr, a)
template <class T, class U>
inline bool smin(T &x, const U &y) {
  return y < x ? x = y, 1 : 0;
}
template <class T, class U>
inline bool smax(T &x, const U &y) {
  return x < y ? x = y, 1 : 0;
}

using LL = long long;
using PII = std::pair<int, int>;
using BS = std::bitset<2000>;
using PBI = std::pair<BS, int>;
int n, m, q;
PBI base[2000];
void ins(PBI x) {
  for (int i = m - 1; i >= 0; i--) {
    if (!x.first[i]) continue;
    if (x.second > base[i].second) {
      std::swap(x, base[i]);
      if (!x.second) break;
    }
    x.first ^= base[i].first;
  }

}
BS a[2005];
std::vector<PBI> g[2005];
int t[2005];
bool ask[2005];
char tmp[2005];
int main() {
  scanf("%d%d%d", &n, &m, &q);
  for (int i = 1; i <= n; i++) {
    scanf("%s", tmp);
    for (int j = 0; j < m; j++) a[i][j] = tmp[m - 1- j] ^ '0';
  }
  for (int i = 1; i <= q; i++) {
    int opt;
    scanf("%d", &opt);
    if (opt == 3) {
      ask[i] = true;
    } else {
      int x, y;
      BS z;
      scanf("%d%d", &x, &y);
      scanf("%s", tmp);
      for (int j = 0; j < m; j++) z[j] = tmp[m - 1- j] ^ '0';
      y++;
      if (opt == 1) {
	if (t[x] != -1) g[t[x]].emplace_back(a[x] ^ a[x - 1], i - 1);
	if (t[y] != -1) g[t[y]].emplace_back(a[y] ^ a[y - 1], i - 1);
	for (int j = x; j < y; j++) a[j] ^= z;
	t[x] = t[y] = i;
      } else {
	for (int j = x; j <= y && j <= n; j++) {
	  if (t[j] != -1) g[t[j]].emplace_back(a[j] ^ a[j - 1], i - 1);
	  t[j] = -1;
	}
	for (int j = x; j < y; j++) a[j] = z;
	t[x] = t[y] = i;
      }
    }
  }
  for (int i = 1; i <= n; i++) if (t[i] != -1) g[t[i]].emplace_back(a[i] ^ a[i - 1], q);
  for (int i = 0; i <= q; i++) {
    for (auto &v : g[i]) ins(v);
    if (!ask[i]) continue;
    BS ans;
    for (int j = m - 1; j >= 0; j--) {
      if (base[j].second >= i && !ans[j]) ans ^= base[j].first;
    }
    for (int j = m - 1; j >= 0; j--) putchar("01"[ans[j]]);
    puts("");
  }
  return 0;
}
```
### 在线
```cpp
// Author:  HolyK
// Created: Mon Jul  5 15:29:33 2021
#include <bits/stdc++.h>
#define dbg(a...) fprintf(stderr, a)
template <class T, class U>
inline bool smin(T &x, const U &y) {
  return y < x ? x = y, 1 : 0;
}
template <class T, class U>
inline bool smax(T &x, const U &y) {
  return x < y ? x = y, 1 : 0;
}

using LL = long long;
using PII = std::pair<int, int>;

constexpr int N(2005);
using BS = std::bitset<N>;
int n, m, q;
int base[N];
BS a[N], v[N], p[N];
void ins(int id) {
  for (int i = m - 1; i >= 0; i--) {
    if (!v[id][i]) continue;
    if (!base[i]) {
      base[i] = id;
      return;
    }
    v[id] ^= v[base[i]];
    p[id] ^= p[base[i]];
  }
}
void update(int id, const BS &z) {
  if (z.none()) return;
  int j = 0;
  for (int i = 1; i <= n; i++) {
    if (v[i].any() || !p[i][id]) continue;
    j = i;
    break;
  }
  if (!j) {
    for (int i = 0; i < m; i++) {
      if (!base[i] || !p[base[i]][id]) continue;
      j = base[i];
      base[i] = 0;
      break;
    }
  }
  assert(j);
  for (int i = 1; i <= n; i++) {
    if (i == j || !p[i][id]) continue;
    v[i] ^= v[j];
    p[i] ^= p[j];
  }
  v[j] ^= z;
  ins(j);
}
int main() {
  std::ios::sync_with_stdio(false);
  std::cin.tie(nullptr);
  std::cin >> n >> m >> q;
  for (int i = 1; i <= n; i++) {
    std::cin >> a[i];
    v[i] = a[i] ^ a[i - 1];
    p[i].set(i);
    ins(i);
  }
  while (q--) {
    int opt, x, y;
    BS z;
    std::cin >> opt;
    if (opt == 1) {
      std::cin >> x >> y >> z;
      update(x, z);
      if (y < n) update(y + 1, z);
      for (int i = x; i <= y; i++) a[i] ^= z;
    } else if (opt == 2) {
      std::cin >> x >> y >> z;
      update(x, a[x] ^ z);
      if (y < n) update(y + 1, a[y] ^ z);
      for (int i = x; i < y; i++) update(i + 1, a[i] ^ a[i + 1]);
      for (int i = x; i <= y; i++) a[i] = z;
    } else {
      z.reset();
      for (int i = m - 1; i >= 0; std::cout << z[i--]) {
	if (base[i] && !z[i]) z ^= v[base[i]];
      }
      std::cout << "\n";
    }
  }
  return 0;
}
```
                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">最后修改于 2021-08-13</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/post/%E8%8E%AB%E9%98%9F/">
			下回<br>莫队小记
                </a>
                
                
                
                <a class="older-posts" href="/post/icpc2014-wfpachinko/">
			上回<br>[ICPC2014 WF]Pachinko
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                










            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	CC BY-NC-SA 4.0
	
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
